## API

Все вызовы API осуществляются через одну точку входа:

```
GET https://kuvert.kz/erlink/api/?action=<action_name>
```

Все ответы представляют собой JSON. За исключением **gettoken**, для каждого вызова требуется заголовок `Authorization` с токеном, полученным через **gettoken**.

---

### Поддерживаемые методы
| Action          | Метод    | Назначение                |
| --------------- | -------- | ------------------------- |
| `gettoken`      | GET      | Получение токена          |
| `getcategories` | GET      | Получение подкатегорий    |
| `getitems`      | GET/POST | Получение списка товаров  |
| `getitemprops`  | GET      | Получение свойств товара  |
| `getitemimages` | GET      | Получение картинок товара |


---
### 1. Получение токена (GetToken)
```
GET /erlink/api/?action=gettoken
```  
**Описание**  
Возвращает Ваш токен авторизации (перед запросом токена авторизируйтесь на сайте)  

**Ответ**  
- Успех: строка  
- Ошибка/нет сессии: `null`  

---

### 2. Список категорий (GetCategories)
```
GET /erlink/api/?action=getcategories&id={parent_id}
```  
**Описание**  
Возвращает подкатегории для указанной родительской категории.

**Параметры**  
| Параметр | Обязательный | Тип     | Описание                                   |
|----------|--------------|---------|--------------------------------------------|
| id       | нет          | integer | ID родительской категории (по умолчанию 0) |

**Ответ**  
```json
{
    "type": "categories",
    "count": 3,
    "parent_id": 229,
    "items": [
        {
            "id": 230,
            "name": "Канцелярский клей, ПВА",
            "active": 1,
            "parent_id": 229
        },
        {
            "id": 231,
            "name": "Клеящие карандаши",
            "active": 1,
            "parent_id": 229
        },
        {
            "id": 232,
            "name": "Универсальный клей",
            "active": 1,
            "parent_id": 229
        }
    ]
}
```

---

### 3. Список товаров (GetItems)
```
GET /erlink/api/?action=getitems
```  
**Описание**  
Постранично возвращает товары. Можно включить в ответ свойства и картинки.  

> Имеется возможность фильтрации и сортировки товаров. Подробнее [тут](#filter)

**Параметры**  
| Параметр     | Обязательный | Тип            | Описание                                                                                       |
|--------------|--------------|----------------|------------------------------------------------------------------------------------------------|
| show_props   | нет          | `0` \| `1`     | Включать ли в ответ свойства товаров (`0` – нет, `1` – да).                                    |
| show_images  | нет          | `0` \| `1`     | Включать ли в ответ массив URL картинок (`0` – нет, `1` – да).                                 |
| page_size    | нет          | integer        | Количество товаров на странице (по умолчанию 10).                                              |
| page_number  | нет          | integer        | Номер страницы, начиная с 0 (по умолчанию 0).                                                  |
| order_by     | нет          | string         | Поле сортировки: `quantity`, `model`, `price`, `name`, `date_modified`, `category_id`.         |

**Пример запроса**
```
GET /api/?
  action=getitems&
  show_props=1&
  show_images=1&
  page_size=5
  page_number=2
```

**Ответ**  
```json
{
  "type": "products",
  "count": 5,
  "page_number": 2,
  "items": [
    {
      "id": 5,
      "name": "Освежитель воздуха OfficeClean &quot;Ароматный букет&quot;, 300 мл",
      "model": "025-250370",
      "status": 1,
      "quantity": 242,
      "price": 445,
      "parent_id": 19,
      "image": "...",
      "props": {
        "type": "itemprops",
        "count": 5,
        "parent_id": 5,
        "items": [
          {
            "id": 25,
            "name": "Распылитель",
            "value": "Да"
          },
          //...
        ]
      },
      "images": ["...", "..."]
    },
    //...
  ]
}
```

---

### 4. Свойства товара  (GetItemProps)
```
GET /erlink/api/?action=getitemprops&id={product_id}
```  
**Описание**  
Возвращает список пользовательских атрибутов (свойств) товара.

**Параметры**  
| Параметр | Обязательный | Тип     | Описание               |
|----------|--------------|---------|------------------------|
| id       | да           | integer | ID товара              |

**Ответ**  
```json
{
  "type": "itemprops",
  "count": 5,
  "parent_id": 5,
  "items": [
    {
      "id": 25,
      "name": "Распылитель",
      "value": "Да"
    },
    //...
  ]
}
```

---

### 5. Картинки товара (GetItemImages)
```
GET /erlink/api/?action=getitemimages&id={product_id}
```  
**Описание**  
Возвращает URL всех дополнительных изображений товара в указанном порядке.

**Параметры**  
| Параметр | Обязательный | Тип     | Описание  |
|----------|--------------|---------|-----------|
| id       | да           | integer | ID товара |

**Ответ**  
```json
[
  "catalog/demo/product1.jpg",
  "catalog/demo/product1_2.jpg",
  "catalog/demo/product1_3.jpg"
]
```

---


### Filter

Для фильтрации элементов используется `POST` запрос:

```
POST /erlink/api/?action=getItems&show_props=1&show_images=1&page_size=10&page_number=0
```

**Заголовки**
| Header        | Значение         |
|---------------|------------------|
| Content-Type  | application/json |
| Authorization |	<Токен>          |


*Поддерживаемые поля для фильтрации*
| Поле          | Описание              |
|---------------|-----------------------|
| `model`	        | Артикул товара        |
| `price`	        | Цена                  |
| `quantity`      | Остаток на складе     |
| `name`          | Название товара       |
| `date_modified` | Дата изменения товара |
| `category_id`   | ID категории товара   |

*Поддерживаемые операторы*
| Оператор | Описание |
|---|---|
| `=` |	Равно |
| `<>` |	Не равно |
| `>` |	Больше |
| `<` |	Меньше |
| `>=` |	Больше или равно |
| `<=` |	Меньше или равно |
| `LIKE` |	Поиск по подстроке (используй %) |
| `IN` |	Вхождение в список значений |
| `BETWEEN` |	Между двумя значениями (массив из двух) |

*Сортировка*
Для сортировки укажите поля order_by и order_dir:
```
"order_by": "price",
"order_dir": "DESC"
```

*Пример простого запроса*
```json
{
  "filters": [
    { "field": "quantity", "operator": ">", "value": 0 },
    { "field": "price", "operator": "<", "value": 5000 }
  ],
  "logic": "AND",
  "order_by": "price",
  "order_dir": "ASC"
}

```

**Пример запроса с группировкой**
```json
{
  "groups": [
    {
      "logic": "AND",
      "filters": [
        { "field": "price", "operator": ">=", "value": 1000 },
        { "field": "quantity", "operator": ">", "value": 0 }
      ]
    },
    {
      "logic": "OR",
      "filters": [
        { "field": "model", "operator": "LIKE", "value": "%abc%" },
        { "field": "name", "operator": "LIKE", "value": "%123%" }
      ]
    }
  ],
  "order_by": "price",
  "order_dir": "ASC"
}
```
